{
  "name": "kikaku-os-api",
  "version": "0.1.0",
  "private": true,
  "module": "esnext",
  "type": "module",
  "scripts": {
    "dev": "wrangler dev --local --config ../../wrangler.toml --port ${PORT:-8787}",
    "build": "wrangler build",
    "test": "vitest run",
    "smoke": "sh -c \"set -e;\nPORT=\\${PORT:-8787};\nROOT_DEVVARS=../../.dev.vars;\nLOG=/tmp/kikaku-os-api-smoke-\\$PORT-\\$\\$.log;\nBAK=/tmp/kikaku-os-api-devvars-\\$PORT-\\$\\$.bak;\n\n# ポートが既に使われてたら誤判定になるので落とす\nif lsof -nP -iTCP:\\$PORT -sTCP:LISTEN >/dev/null 2>&1; then\n  echo Port \\$PORT already in use. Set PORT=... and retry.\n  exit 1\nfi\n\ncleanup(){\n  if [ -n \\${PID:-} ]; then kill \\$PID 2>/dev/null || true; wait \\$PID 2>/dev/null || true; fi\n  if [ -f \\$BAK ]; then mv \\$BAK \\$ROOT_DEVVARS 2>/dev/null || true; fi\n}\ntrap cleanup EXIT INT TERM\n\ntest -f \\$ROOT_DEVVARS || { echo Missing \\$ROOT_DEVVARS; exit 1; }\ncp \\$ROOT_DEVVARS \\$BAK\nperl -0777 -i -pe 's/^\\s*STRIPE_SECRET_KEY\\s*=.*$/STRIPE_SECRET_KEY=pk_test_xxx/m' \\$ROOT_DEVVARS\n\nPORT=\\$PORT pnpm dev >\\$LOG 2>&1 & PID=\\$!\n\nPING=\\$(curl -sS --retry 30 --retry-delay 1 --retry-connrefused -w '\\n%{http_code}' http://127.0.0.1:\\$PORT/dev/ping 2>/dev/null)\nPING_STATUS=\\$(printf '%s\\n' \\\"\\$PING\\\" | tail -n 1)\nPING_BODY=\\$(printf '%s\\n' \\\"\\$PING\\\" | sed '\\$d')\nprintf 'GET /dev/ping -> %s %s\\n' \\\"\\$PING_STATUS\\\" \\\"\\$PING_BODY\\\"\n[ \\\"\\$PING_STATUS\\\" = 200 ]\nprintf '%s' \\\"\\$PING_BODY\\\" | grep -Fq '\\\"dev_mode\\\":true'\nprintf '%s' \\\"\\$PING_BODY\\\" | grep -Fq '\\\"name\\\":\\\"kikaku-os-api\\\"'\n\nCHECKOUT=\\$(curl -sS -w '\\n%{http_code}' -H content-type:application/json -d '{\\\"variantId\\\":1,\\\"quantity\\\":1}' http://127.0.0.1:\\$PORT/checkout/session 2>/dev/null)\nCHECKOUT_STATUS=\\$(printf '%s\\n' \\\"\\$CHECKOUT\\\" | tail -n 1)\nCHECKOUT_BODY=\\$(printf '%s\\n' \\\"\\$CHECKOUT\\\" | sed '\\$d')\nprintf 'POST /checkout/session -> %s %s\\n' \\\"\\$CHECKOUT_STATUS\\\" \\\"\\$CHECKOUT_BODY\\\"\n[ \\\"\\$CHECKOUT_STATUS\\\" = 500 ]\nprintf '%s' \\\"\\$CHECKOUT_BODY\\\" | grep -Fq '\\\"code\\\":\\\"STRIPE_SECRET_KEY_INVALID\\\"'\n\""
  },
  "dependencies": {
    "hono": "^4.5.0"
  },
  "devDependencies": {
    "@cloudflare/workers-types": "^4.20240614.0",
    "typescript": "^5.4.0",
    "vitest": "^1.6.1",
    "wrangler": "^4.59.1"
  }
}
