---
export const prerender = false;

import AdminLayout from '../../../layouts/AdminLayout.astro';
import { Alert } from '../../../components/catalyst/alert-banner';
import InquiryDetail from '../../../components/admin/InquiryDetail';
import { getApiBase } from '../../../lib/api';
import { fetchAdminResource } from '../../../lib/admin/fetch-helpers';

const apiBase = getApiBase();
const apiKey = import.meta.env.ADMIN_API_KEY;
const { id } = Astro.params;

let inquiry: any = null;
let error: string | null = null;

const { data, error: fetchError } = await fetchAdminResource<{ inquiry: any }>({
	apiBase,
	apiKey: apiKey || '',
	resource: 'inquiries',
	id: id!,
	notFoundMessage: 'お問い合わせが見つかりません。',
	errorMessage: 'お問い合わせの読み込みに失敗しました。',
});
if (data) {
	inquiry = data.inquiry || null;
}
error = fetchError;
---

<AdminLayout title={inquiry ? `お問い合わせ #${id} - Admin` : 'お問い合わせ - Admin'}>
	<div class="space-y-6 max-w-3xl">
		{error && (
			<Alert color="red" client:load>
				{error}
			</Alert>
		)}

		{inquiry ? (
			<InquiryDetail client:load inquiry={inquiry} apiBase={apiBase} />
		) : !error ? (
			<Alert color="amber" client:load>
				お問い合わせが見つかりません。
			</Alert>
		) : null}
	</div>
</AdminLayout>
