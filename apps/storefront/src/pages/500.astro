---
import Layout from '../layouts/Layout.astro';
import Container from '../components/Container.astro';
import { t } from '../i18n';

const errorTrackingId = `ERR-${Date.now()}-${Math.random().toString(36).slice(2, 6)}`;

const popularCategories = [
	{ slug: 'led-grow-lights', label: 'LED Grow Lights' },
	{ slug: 'led-panels', label: 'LED Panels' },
	{ slug: 'accessories', label: 'Accessories' },
	{ slug: 'controllers', label: 'Controllers' },
];
---

<Layout title={`${t('errors.serverErrorCode')} - ${t('errors.serverError')}`}>
	<div class="min-h-[60vh] flex items-center justify-center py-20">
		<Container>
			<div class="text-center max-w-2xl mx-auto">
				{/* Illustration */}
				<div class="mx-auto mb-6">
					<svg
						xmlns="http://www.w3.org/2000/svg"
						viewBox="0 0 240 160"
						class="mx-auto h-40 w-60"
						aria-hidden="true"
					>
						<rect width="240" height="160" fill="none" />
						{/* Server rack illustration */}
						<rect x="70" y="20" width="100" height="110" rx="8" fill="#f5f5f7" stroke="#d2d2d7" stroke-width="1.5" />
						{/* Server slots */}
						<rect x="82" y="32" width="76" height="20" rx="3" fill="white" stroke="#d2d2d7" stroke-width="1" />
						<rect x="82" y="60" width="76" height="20" rx="3" fill="white" stroke="#d2d2d7" stroke-width="1" />
						<rect x="82" y="88" width="76" height="20" rx="3" fill="white" stroke="#d2d2d7" stroke-width="1" />
						{/* Status lights - green, green, red (error) */}
						<circle cx="92" cy="42" r="3" fill="#34c759" />
						<circle cx="92" cy="70" r="3" fill="#34c759" />
						<circle cx="92" cy="98" r="3" fill="#ff3b30" />
						{/* Drive bays */}
						<rect x="102" y="38" width="48" height="8" rx="1.5" fill="#f5f5f7" stroke="#d2d2d7" stroke-width="0.5" />
						<rect x="102" y="66" width="48" height="8" rx="1.5" fill="#f5f5f7" stroke="#d2d2d7" stroke-width="0.5" />
						<rect x="102" y="94" width="48" height="8" rx="1.5" fill="#f5f5f7" stroke="#d2d2d7" stroke-width="0.5" />
						{/* Warning triangle */}
						<path d="M120 140 L130 155 L110 155 Z" fill="none" stroke="#ff9500" stroke-width="1.5" stroke-linejoin="round" />
						<text x="120" y="153" text-anchor="middle" font-size="10" font-weight="700" fill="#ff9500" font-family="system-ui, sans-serif">!</text>
					</svg>
				</div>

				<p class="text-[80px] md:text-[120px] font-bold text-[#d2d2d7] leading-none select-none" aria-hidden="true">
					{t('errors.serverErrorCode')}
				</p>
				<h1 class="mt-4 text-[28px] md:text-[32px] font-semibold text-primary tracking-tight">
					{t('errors.serverError')}
				</h1>
				<p class="mt-3 text-[17px] text-secondary leading-relaxed">
					{t('errors.serverErrorMessage')}
				</p>

				{/* Error tracking ID */}
				<p class="mt-4 text-xs text-muted font-mono">
					{t('errors.errorTrackingId', { id: errorTrackingId })}
				</p>

				{/* Action buttons: retry + home + search */}
				<div class="mt-8 flex flex-col sm:flex-row items-center justify-center gap-3">
					<button
						id="reload-btn"
						type="button"
						class="inline-flex items-center gap-2 px-6 py-3 bg-brand text-white text-[15px] font-medium rounded-full hover:bg-brand-hover transition-colors"
					>
						<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><polyline points="23 4 23 10 17 10"/><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/></svg>
						{t('errors.reload')}
					</button>
					<a
						href="/"
						class="inline-flex items-center gap-2 px-6 py-3 border border-[#d2d2d7] text-primary text-[15px] font-medium rounded-full hover:bg-subtle transition-colors"
					>
						<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
						{t('errors.backToHome')}
					</a>
					<button
						id="search-btn-500"
						type="button"
						class="inline-flex items-center gap-2 px-6 py-3 border border-[#d2d2d7] text-primary text-[15px] font-medium rounded-full hover:bg-subtle transition-colors"
					>
						<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
						{t('errors.searchProducts')}
					</button>
				</div>

				{/* Contact support */}
				<div class="mt-10 border-t border-[#d2d2d7]/40 pt-6">
					<p class="text-[14px] text-secondary leading-relaxed">
						{t('errors.contactSupport')}
					</p>
					<a
						href={`/contact?error_id=${errorTrackingId}`}
						class="inline-flex items-center gap-1.5 mt-3 text-[14px] font-medium text-brand hover:text-brand-hover transition-colors"
					>
						<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
						{t('errors.contactUs')}
					</a>
				</div>

				{/* Popular categories */}
				<div class="mt-8 border-t border-[#d2d2d7]/40 pt-6">
					<p class="text-[13px] font-medium text-muted uppercase tracking-wider mb-4">
						{t('errors.popularCategories')}
					</p>
					<div class="flex flex-wrap items-center justify-center gap-2">
						{popularCategories.map((cat) => (
							<a
								href={`/categories/${encodeURIComponent(cat.slug)}`}
								class="inline-flex items-center gap-1.5 px-4 py-2 rounded-full bg-white text-[13px] font-medium text-primary border border-[#d2d2d7]/60 hover:border-brand hover:text-brand transition-colors shadow-sm"
							>
								<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
									<path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/>
								</svg>
								{cat.label}
							</a>
						))}
					</div>
				</div>
			</div>
		</Container>
	</div>

	<script>
		document.getElementById('reload-btn')?.addEventListener('click', () => {
			window.location.reload();
		});
		document.getElementById('search-btn-500')?.addEventListener('click', () => {
			window.dispatchEvent(new CustomEvent('open-search'));
		});
	</script>
</Layout>
