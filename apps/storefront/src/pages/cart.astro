---
import Layout from '../layouts/Layout.astro';
import Breadcrumb from '../components/Breadcrumb.astro';
import CartComponent from '../components/Cart';
import { t } from '../i18n';
---

<Layout title={t('cart.pageTitle')}>
	<div class="bg-white">
		<Breadcrumb items={[
			{ label: t('breadcrumb.home'), href: '/' },
			{ label: t('cart.title') },
		]} />
		<div class="mx-auto max-w-2xl px-4 pt-8 pb-24 sm:px-6 lg:max-w-7xl lg:px-8">
			<h1 class="text-3xl font-bold tracking-tight text-neutral-900 sm:text-4xl">{t('cart.title')}</h1>

			<div class="mt-12">
				<!-- Cart skeleton: shown during hydration, hidden once React mounts -->
				<div role="status" aria-live="polite" class="sr-only">{t('cart.shippingConfigLoading')}</div>
				<div id="cart-skeleton" class="lg:grid lg:grid-cols-12 lg:items-start lg:gap-x-12 xl:gap-x-16" aria-hidden="true">
					<div class="lg:col-span-7">
						<div class="divide-y divide-gray-200 border-t border-b border-gray-200">
							{[1, 2, 3].map(() => (
								<div class="flex py-6 sm:py-10 animate-pulse">
									<div class="size-24 rounded-md bg-gray-200 sm:size-48 shrink-0"></div>
									<div class="ml-4 flex-1 sm:ml-6">
										<div class="h-4 w-3/4 rounded bg-gray-200"></div>
										<div class="mt-2 h-3 w-1/2 rounded bg-gray-200"></div>
										<div class="mt-2 h-4 w-1/4 rounded bg-gray-200"></div>
									</div>
								</div>
							))}
						</div>
					</div>
					<div class="lg:col-span-5">
						<div class="rounded-lg bg-gray-50 px-4 py-6 sm:p-6 lg:p-8 animate-pulse">
							<div class="h-5 w-1/3 rounded bg-gray-200"></div>
							<div class="mt-6 space-y-4">
								<div class="flex justify-between">
									<div class="h-3 w-1/4 rounded bg-gray-200"></div>
									<div class="h-3 w-1/6 rounded bg-gray-200"></div>
								</div>
								<div class="flex justify-between">
									<div class="h-3 w-1/4 rounded bg-gray-200"></div>
									<div class="h-3 w-1/6 rounded bg-gray-200"></div>
								</div>
								<div class="flex justify-between border-t border-gray-200 pt-4">
									<div class="h-4 w-1/3 rounded bg-gray-200"></div>
									<div class="h-4 w-1/5 rounded bg-gray-200"></div>
								</div>
							</div>
							<div class="mt-6 h-12 w-full rounded-lg bg-gray-200"></div>
						</div>
					</div>
				</div>
				<CartComponent client:only="react" />
			</div>
		</div>
	</div>
</Layout>

<script is:inline>
	// Hide skeleton once the Cart React component renders
	const observer = new MutationObserver(function(mutations) {
		for (const mutation of mutations) {
			if (mutation.addedNodes.length > 0) {
				const skeleton = document.getElementById('cart-skeleton');
				if (skeleton) skeleton.remove();
				observer.disconnect();
				break;
			}
		}
	});
	const cartIsland = document.querySelector('astro-island[component-export]');
	if (cartIsland) {
		if (cartIsland.children.length > 0) {
			const skeleton = document.getElementById('cart-skeleton');
			if (skeleton) skeleton.remove();
		} else {
			observer.observe(cartIsland, { childList: true });
		}
	}
</script>
