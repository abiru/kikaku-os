---
import Layout from '../layouts/Layout.astro';
import HomeHero from "../components/HomeHero.astro";
import HomeCategoryGrid from "../components/HomeCategoryGrid.astro";
import LogoGrid from "../components/LogoGrid.astro";
import Copy from "../components/Copy.astro";
import Research from "../components/Research.astro";
import { getApiBase } from '../lib/api';
import { t } from '../i18n';
import type { HeroSection, Product } from '../lib/types';

const apiBase = getApiBase();

// SSR: Fetch hero sections from API
let heroes: HeroSection[] = [];
try {
  const res = await fetch(`${apiBase}/store/home/heroes`);
  if (res.ok) {
    const data = await res.json();
    heroes = data.heroes || [];
  }
} catch (error) {
  console.error('Failed to fetch heroes:', error);
}

// SSR: Fetch featured products for category grid
let featuredProducts: Product[] = [];
try {
  const res = await fetch(`${apiBase}/store/home/featured-categories`);
  if (res.ok) {
    const data = await res.json();
    featuredProducts = data.products || [];
  }
} catch (error) {
  console.error('Failed to fetch featured products:', error);
}
---

<Layout title="Led Kikaku - Pro Growth">
	<div class="bg-subtle">
		{/* Hero Section - Apple Style Jumbotron */}

  <div class="relative left-1/2 right-1/2 w-screen -mx-[50vw] bg-white">
    <div class="mx-auto w-full max-w-[2560px] bg-white space-y-4 px-0 py-8 sm:py-0">
      <Copy />

    <LogoGrid />
    {heroes.length > 0 && (
      heroes.map((hero) => (
        <HomeHero
          title={hero.title}
          subtitle={hero.subtitle}
          image={hero.image}
          imageSmall={hero.imageSmall}
          ctaPrimaryText={hero.cta_primary_text}
          ctaPrimaryUrl={hero.cta_primary_url}
          ctaSecondaryText={hero.cta_secondary_text}
          ctaSecondaryUrl={hero.cta_secondary_url}
        />
      ))
    )}

      <HomeCategoryGrid products={featuredProducts} />
      <Research />
    </div>
  </div>
	</div>
</Layout>
