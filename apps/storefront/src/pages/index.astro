---
import Layout from '../layouts/Layout.astro';
import HomeHero from "../components/HomeHero.astro";
import HomeCategoryGrid from "../components/HomeCategoryGrid.astro";
import LogoGrid from "../components/LogoGrid.astro";
import Copy from "../components/Copy.astro";
import Research from "../components/Research.astro";
import { getApiBase } from '../lib/api';
import { t } from '../i18n';
import { logError } from '../lib/logger';
import type { HeroSection, Product } from '../lib/types';

const apiBase = getApiBase();

// SSR: Fetch hero sections from API
let heroes: HeroSection[] = [];
try {
  const res = await fetch(`${apiBase}/store/home/heroes`);
  if (res.ok) {
    const data = await res.json();
    heroes = data.heroes || [];
  }
} catch (e) {
  logError('Failed to fetch heroes', e, { page: 'index', action: 'fetchHeroes' });
}

// SSR: Fetch featured products for category grid
let featuredProducts: Product[] = [];
try {
  const res = await fetch(`${apiBase}/store/home/featured-categories`);
  if (res.ok) {
    const data = await res.json();
    featuredProducts = data.products || [];
  }
} catch (e) {
  logError('Failed to fetch featured products', e, { page: 'index', action: 'fetchFeaturedProducts' });
}
// Organization JSON-LD for SEO
const siteUrl = 'https://led-kikaku.com';
const jsonLdOrganization = {
	'@context': 'https://schema.org',
	'@type': 'Organization',
	name: t('seo.siteName'),
	url: siteUrl,
	description: t('seo.orgDescription'),
	logo: `${siteUrl}/favicon.svg`,
};
---

<Layout title="Led Kikaku - Pro Growth" description={t('seo.homeDescription')}>
	<script type="application/ld+json" set:html={JSON.stringify(jsonLdOrganization)} />
	<div class="bg-subtle">
		{/* Hero Section - Apple Style Jumbotron */}

  <div class="relative left-1/2 right-1/2 w-screen -mx-[50vw] bg-white">
    <div class="mx-auto w-full max-w-[2560px] bg-white space-y-4 px-0 py-8 sm:py-0">
      <Copy />

    <LogoGrid />
    {heroes.length > 0 ? (
      heroes.map((hero) => (
        <HomeHero
          title={hero.title}
          subtitle={hero.subtitle}
          image={hero.image}
          imageSmall={hero.imageSmall}
          ctaPrimaryText={hero.cta_primary_text}
          ctaPrimaryUrl={hero.cta_primary_url}
          ctaSecondaryText={hero.cta_secondary_text}
          ctaSecondaryUrl={hero.cta_secondary_url}
        />
      ))
    ) : (
      <section class="py-16 text-center">
        <div class="mx-auto max-w-2xl px-6">
          <h2 class="text-3xl font-bold tracking-tight text-primary">{t('home.heroTagline')}</h2>
          <p class="mt-4 text-lg text-secondary">{t('home.heroSubtagline')}</p>
          <div class="mt-8">
            <a href="/products" class="rounded-lg bg-brand px-6 py-3 h-12 inline-flex items-center text-base font-semibold text-white hover:bg-brand-hover active:scale-[0.98] focus-visible:outline-none focus-visible:ring-3 focus-visible:ring-brand/30 transition-colors">
              {t('home.viewProducts')}
            </a>
          </div>
        </div>
      </section>
    )}

      {featuredProducts.length > 0 ? (
        <HomeCategoryGrid products={featuredProducts} />
      ) : (
        <section class="py-16 text-center bg-white">
          <div class="mx-auto max-w-2xl px-6">
            <h2 class="text-2xl font-bold tracking-tight text-primary">{t('home.viewProducts')}</h2>
            <p class="mt-4 text-secondary">{t('home.heroSubtagline')}</p>
            <div class="mt-6">
              <a href="/products" class="rounded-lg bg-brand px-6 py-3 h-12 inline-flex items-center text-base font-semibold text-white hover:bg-brand-hover active:scale-[0.98] focus-visible:outline-none focus-visible:ring-3 focus-visible:ring-brand/30 transition-colors">
                {t('home.viewProducts')}
              </a>
            </div>
          </div>
        </section>
      )}
      <Research />
    </div>
  </div>
	</div>
</Layout>
