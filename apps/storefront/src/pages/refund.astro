---
export const prerender = false;

import Container from '../components/Container.astro';
import Layout from '../layouts/Layout.astro';
import { getApiBase } from '../lib/api';
import { parseMarkdown } from '../utils/markdown';
import { formatDate } from '../lib/format';
import { t } from '../i18n';

type StaticPage = {
	id: number;
	slug: string;
	title: string;
	meta_title: string | null;
	meta_description: string | null;
	body: string;
	status: string;
	updated_at: string;
};

let page: StaticPage | null = null;
let error: string | null = null;

try {
	const apiBase = getApiBase();
	const res = await fetch(`${apiBase}/store/pages/refund`);
	if (res.ok) {
		const data = await res.json();
		page = data.page;
	}
} catch (e) {
	console.error('Failed to fetch page:', e);
	error = t('cms.loadError');
}

const metaTitle = page?.meta_title || '返品・返金について - Led Kikaku';
const metaDescription = page?.meta_description || '';

---

<Layout title={metaTitle}>
	{metaDescription && (
		<meta slot="head" name="description" content={metaDescription} />
	)}
	<div class="bg-white min-h-screen">
		{/* Header */}
		<section class="pt-24 pb-16 md:pt-32 md:pb-24">
			<Container>
				<h1 class="text-4xl md:text-5xl font-bold tracking-tight text-center text-primary">
					{page?.title || '返品・返金について'}
				</h1>
				{page && (
					<p class="mt-6 text-center text-secondary text-lg font-medium">
						{t('cms.lastUpdated', { date: formatDate(page.updated_at, { year: 'numeric', month: 'long', day: 'numeric' }) })}
					</p>
				)}
			</Container>
		</section>

		{/* Content */}
		<section class="pb-24">
			<Container class="max-w-3xl">
				{page && page.body ? (
					<div class="prose prose-lg max-w-none" set:html={parseMarkdown(page.body)} />
				) : error ? (
					<div class="text-center py-12">
						<p class="text-secondary">{error}</p>
					</div>
				) : (
					<div class="prose prose-lg max-w-none">
						<p>{t('cms.fallback.refund')}</p>
					</div>
				)}
			</Container>
		</section>
	</div>
</Layout>
