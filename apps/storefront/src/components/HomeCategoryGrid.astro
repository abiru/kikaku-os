---
import { t } from '../i18n';

interface FeaturedProduct {
  id: number;
  title: string;
  description: string | null;
  category: string | null;
  image: string | null;
}

interface Props {
  products?: FeaturedProduct[];
}

const { products = [] } = Astro.props as Props;

// Fallback placeholder if no image
const placeholderBg = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMSIgaGVpZ2h0PSIxIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9IiNmNWY1ZjciLz48L3N2Zz4=';
---

<section class="grid gap-4 bg-white px-4 sm:grid-cols-2">
  {products.length > 0 ? (
    products.map((product) => {
      const bgImage = product.image || placeholderBg;
      const categoryName = product.category || 'Products';
      const description = product.description || 'Explore our products';

      return (
        <article
          class="category-card relative flex h-[580px] flex-col items-center px-6 py-8 text-center overflow-visible"
        >
          <img
            src={bgImage}
            alt={categoryName}
            loading="lazy"
            class="absolute inset-0 w-full h-full object-cover -z-10"
          />
          <div class="category-text space-y-2">
            <h3 class="text-4xl font-black text-neutral-900">
              {categoryName}
            </h3>
            <p class="mt-4 text-xl font-semibold text-neutral-600">
              {description}
            </p>
          </div>

          <div class="category-text mt-4 flex gap-2">
            <a
              href={`/products?category=${encodeURIComponent(product.category || '')}`}
              class="rounded-full bg-brand px-5 py-2.5 min-h-[44px] inline-flex items-center text-sm font-semibold text-white hover:bg-brand-active transition-colors focus:outline-none focus:ring-2 focus:ring-brand focus:ring-offset-2"
            >
              {t('home.viewProducts')}
            </a>
            <a
              href={`/products/${product.id}`}
              class="rounded-full border border-brand px-5 py-2.5 min-h-[44px] inline-flex items-center text-sm font-semibold text-brand hover:bg-brand hover:text-white transition-colors focus:outline-none focus:ring-2 focus:ring-brand focus:ring-offset-2"
            >
              {t('home.viewDetails')}
            </a>
          </div>

          <div class="mt-6 h-40 w-full" aria-hidden="true"></div>
        </article>
      );
    })
  ) : (
    <div class="col-span-2 py-12 text-center text-gray-500">
      {t('home.configureFeatured')}
    </div>
  )}
</section>

<style>
  .category-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(180deg, rgba(255,255,255,0.5) 0%, rgba(255,255,255,0.7) 100%);
    pointer-events: none;
    z-index: 0;
  }

  .category-text {
    position: relative;
    z-index: 1;
    text-shadow: 0 1px 3px rgba(255,255,255,0.6);
  }
</style>
