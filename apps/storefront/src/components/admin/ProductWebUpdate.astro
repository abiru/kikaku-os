---
import { Fieldset, Field, Label } from '../catalyst/fieldset';
import { Input } from '../catalyst/input';
import { Subheading } from '../catalyst/heading';
---

<div class="mt-8">
	<div class="flex items-center justify-between mb-4">
		<Subheading>Web更新</Subheading>
	</div>
	<div class="bg-white rounded-xl border border-gray-200 shadow-sm p-4 space-y-4">
		<Fieldset client:load>
			<Field>
				<Label>商品ページURL</Label>
				<div class="flex gap-2">
					<Input
						type="url"
						id="fetch-url"
						placeholder="https://www.spider-farmer.com/products/..."
						className="flex-1"
					/>
				<button
					type="button"
					id="fetch-btn"
					class="px-4 py-2 text-sm font-medium text-white bg-[#0071e3] rounded-lg hover:bg-[#0077ED] transition-colors flex items-center gap-2"
				>
					<svg id="fetch-spinner" class="hidden animate-spin w-4 h-4" fill="none" viewBox="0 0 24 24">
						<circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
						<path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
					</svg>
					<span id="fetch-label">取得</span>
				</button>
				</div>
				<p class="text-xs text-[#86868b] mt-1">メーカーの公式サイトURLを入力して情報を取得します</p>
			</Field>
		</Fieldset>

		<div id="fetch-error" class="hidden">
			<div class="bg-red-50 border border-red-200 text-red-600 px-4 py-3 rounded-lg text-sm"></div>
		</div>

		<div id="fetch-warning" class="hidden">
			<div class="bg-amber-50 border border-amber-200 text-amber-700 px-4 py-3 rounded-lg text-sm"></div>
		</div>

		<div id="fetch-preview" class="hidden border-t border-gray-100 pt-4 space-y-4">
			<h3 class="text-sm font-semibold text-zinc-950">取得結果</h3>

			<!-- Image -->
			<div class="flex gap-4">
				<div class="flex-shrink-0">
					<p class="text-xs text-[#86868b] mb-1">画像</p>
					<img id="preview-image" src="" alt="Preview" width="128" height="128" class="w-32 h-32 object-contain rounded-lg bg-gray-50" />
				</div>
				<div class="flex-1 space-y-2">
					<div>
						<p class="text-xs text-[#86868b]">取得元タイトル</p>
						<p id="preview-original-title" class="text-sm text-zinc-950"></p>
					</div>
					<div>
						<p class="text-xs text-[#86868b]">スペック</p>
						<p id="preview-specs" class="text-xs text-zinc-950 font-mono"></p>
					</div>
					<div>
						<p class="text-xs text-[#86868b]">ソース</p>
						<p id="preview-source" class="text-sm text-zinc-950 font-mono"></p>
					</div>
				</div>
			</div>

			<!-- Generated Title -->
			<div class="p-3 bg-blue-50 rounded-lg">
				<p class="text-xs text-blue-600 mb-1">生成されたタイトル</p>
				<p id="preview-generated-title" class="text-sm font-medium text-zinc-950"></p>
			</div>

			<!-- Generated Description -->
			<div>
				<p class="text-xs text-[#86868b] mb-1">生成された説明文</p>
				<div id="preview-generated-description" class="p-4 bg-gray-50 rounded-lg text-sm prose prose-sm max-w-none max-h-64 overflow-y-auto"></div>
			</div>

			<div class="flex flex-wrap gap-2 pt-2">
				<button
					type="button"
					id="apply-all-btn"
					class="px-4 py-2 text-sm font-medium text-white bg-green-600 rounded-lg hover:bg-green-700 transition-colors"
				>
					すべて適用
				</button>
				<button
					type="button"
					id="apply-title-only-btn"
					class="px-4 py-2 text-sm font-medium text-green-700 bg-green-100 rounded-lg hover:bg-green-200 transition-colors"
				>
					タイトルのみ
				</button>
				<button
					type="button"
					id="apply-desc-only-btn"
					class="px-4 py-2 text-sm font-medium text-green-700 bg-green-100 rounded-lg hover:bg-green-200 transition-colors"
				>
					説明文のみ
				</button>
				<button
					type="button"
					id="send-inbox-btn"
					class="px-4 py-2 text-sm font-medium text-white bg-purple-600 rounded-lg hover:bg-purple-700 transition-colors"
				>
					Inboxに送信
				</button>
				<button
					type="button"
					id="cancel-preview-btn"
					class="px-4 py-2 text-sm font-medium text-zinc-950 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors"
				>
					キャンセル
				</button>
			</div>
		</div>

		<div id="apply-success" class="hidden">
			<div class="bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded-lg text-sm">
				Inboxに送信しました。<a href="/admin/inbox" class="underline">Inbox</a>で承認してください。
			</div>
		</div>
	</div>
</div>
