---
import { t } from '../i18n';

interface Props {
  title: string;
  subtitle?: string | null;
  image?: string | null;
  imageSmall?: string | null;
  ctaPrimaryText?: string | null;
  ctaPrimaryUrl?: string | null;
  ctaSecondaryText?: string | null;
  ctaSecondaryUrl?: string | null;
}

const {
  title,
  subtitle,
  image,
  imageSmall,
  ctaPrimaryText = t('home.viewProducts'),
  ctaPrimaryUrl = '/products',
  ctaSecondaryText,
  ctaSecondaryUrl
} = Astro.props;

// Use provided images or fallback to transparent placeholder
const bgLarge = image || 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMSIgaGVpZ2h0PSIxIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9IiNmNWY1ZjciLz48L3N2Zz4=';
const bgSmall = imageSmall || image || bgLarge;
---

<section
  class="hero fade-in bg-subtle h-[500px] md:h-[692px] bg-cover bg-center bg-no-repeat"
  style={`--bg-large: url(${bgLarge}); --bg-small: url(${bgSmall});`}
>
  <div class="hero-scrim pt-8 md:pt-24 text-center">
    <h2
      class="typo-h1 text-neutral-900"
    >
      {title}
    </h2>
    {subtitle && (
      <p class="mt-4 text-sm sm:text-xl font-semibold text-neutral-500">
        {subtitle}
      </p>
    )}
    <div class="mt-4 flex flex-col sm:flex-row justify-center gap-2">
      {ctaPrimaryText && ctaPrimaryUrl && (
        <a
          href={ctaPrimaryUrl}
          class="w-full sm:w-auto h-12 px-6 py-3 rounded-lg bg-brand inline-flex items-center justify-center text-base font-semibold text-white hover:bg-brand-hover active:scale-[0.98] focus-visible:outline-none focus-visible:ring-3 focus-visible:ring-brand/30 transition-colors"
        >
          {ctaPrimaryText}
        </a>
      )}
      {ctaSecondaryText && ctaSecondaryUrl && (
        <a
          href={ctaSecondaryUrl}
          class="w-full sm:w-auto h-12 px-6 py-3 rounded-lg border border-border inline-flex items-center justify-center text-base font-semibold text-primary hover:bg-subtle active:scale-[0.98] focus-visible:outline-none focus-visible:ring-3 focus-visible:ring-brand/30 transition-colors"
        >
          {ctaSecondaryText}
        </a>
      )}
    </div>
  </div>
</section>

<style>
  /* 背景切り替え */
  .hero {
    background-image: var(--bg-large);
  }
  @media (max-width: 768px) {
    .hero {
      background-image: var(--bg-small);
    }
  }

  /* テキスト視認性のためのスクリム */
  .hero-scrim {
    background: linear-gradient(to bottom, rgba(255, 255, 255, 0.85) 0%, rgba(255, 255, 255, 0.6) 100%);
    padding-left: 1rem;
    padding-right: 1rem;
    padding-bottom: 2rem;
  }

  /* フェードイン初期状態 */
  .fade-in {
    opacity: 0;
    transform: translateY(24px);
    transition:
      opacity 0.8s ease,
      transform 0.8s cubic-bezier(0.16, 1, 0.3, 1);
    will-change: opacity, transform;
  }

  /* 表示状態 */
  .fade-in.is-visible {
    opacity: 1;
    transform: translateY(0);
  }

  /* モーション低減設定時はアニメーション無効化 */
  @media (prefers-reduced-motion: reduce) {
    .fade-in {
      opacity: 1;
      transform: none;
      transition: none;
      will-change: auto;
    }
  }
</style>

<script>
  const observer = new IntersectionObserver(
    (entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          entry.target.classList.add("is-visible");
          observer.unobserve(entry.target);
        }
      });
    },
    {
      threshold: 0.2,
    }
  );

  document.querySelectorAll(".fade-in").forEach((el) => {
    observer.observe(el);
  });
</script>
