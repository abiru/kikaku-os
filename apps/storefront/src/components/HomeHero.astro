---
import { t } from '../i18n';
import { FOCUS_RING } from '../lib/focusRing';
import { buildSrcSet } from '../lib/responsiveImage';

interface Props {
  title: string;
  subtitle?: string | null;
  image?: string | null;
  imageSmall?: string | null;
  ctaPrimaryText?: string | null;
  ctaPrimaryUrl?: string | null;
  ctaSecondaryText?: string | null;
  ctaSecondaryUrl?: string | null;
}

const {
  title,
  subtitle,
  image,
  imageSmall,
  ctaPrimaryText = t('home.viewProducts'),
  ctaPrimaryUrl = '/products',
  ctaSecondaryText,
  ctaSecondaryUrl
} = Astro.props;

// Use provided images or fallback to transparent placeholder
const placeholderSvg = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMSIgaGVpZ2h0PSIxIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9IiNmNWY1ZjciLz48L3N2Zz4=';
const bgLarge = image || placeholderSvg;
const bgSmall = imageSmall || image || placeholderSvg;
const hasRealImage = !!image && !image.startsWith('data:');
const srcsetLarge = buildSrcSet(bgLarge, 'hero');
const srcsetSmall = buildSrcSet(bgSmall, 'hero');
---

<section
  class="hero relative min-h-[60vh] md:min-h-[70vh] flex items-end overflow-hidden"
  data-reveal
>
  {/* Hero background image with responsive srcset */}
  {hasRealImage ? (
    <picture>
      {srcsetSmall && (
        <source
          media="(max-width: 768px)"
          srcset={srcsetSmall}
          sizes="100vw"
          type="image/webp"
        />
      )}
      {srcsetLarge && (
        <source
          media="(min-width: 769px)"
          srcset={srcsetLarge}
          sizes="100vw"
          type="image/webp"
        />
      )}
      <img
        src={bgLarge}
        srcset={srcsetLarge}
        sizes="100vw"
        alt=""
        role="presentation"
        loading="eager"
        decoding="sync"
        fetchpriority="high"
        class="absolute inset-0 w-full h-full object-cover"
      />
    </picture>
  ) : (
    <div
      class="absolute inset-0 w-full h-full bg-cover bg-center bg-no-repeat"
      style={`background-image: url(${bgLarge});`}
      role="presentation"
    />
  )}

  <div class="hero-scrim relative z-10 w-full px-4 pb-12 pt-40 md:pt-48 text-center">
    <h2
      class="text-2xl font-extrabold tracking-tighter sm:text-5xl text-white"
    >
      {title}
    </h2>
    {subtitle && (
      <p class="mt-4 text-sm sm:text-xl font-semibold text-neutral-200">
        {subtitle}
      </p>
    )}
    <div class="mt-4 flex flex-col sm:flex-row justify-center gap-2">
      {ctaPrimaryText && ctaPrimaryUrl && (
        <a
          href={ctaPrimaryUrl}
          class={`w-full sm:w-auto h-12 px-6 py-3 rounded-lg bg-brand inline-flex items-center justify-center text-base font-semibold text-white hover:bg-brand-active active:scale-[0.98] ${FOCUS_RING} transition-colors`}
        >
          {ctaPrimaryText}
        </a>
      )}
      {ctaSecondaryText && ctaSecondaryUrl && (
        <a
          href={ctaSecondaryUrl}
          class={`w-full sm:w-auto h-12 px-6 py-3 rounded-lg bg-white/15 backdrop-blur-sm border border-white/25 inline-flex items-center justify-center text-base font-semibold text-white hover:bg-white/25 active:scale-[0.98] ${FOCUS_RING} transition-colors`}
        >
          {ctaSecondaryText}
        </a>
      )}
    </div>
  </div>
</section>

<style>
  /* ボトムウェイトのダークスクリム */
  .hero-scrim {
    background: linear-gradient(to top, rgba(0, 0, 0, 0.5) 0%, transparent 60%);
  }
</style>
