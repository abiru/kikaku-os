---
import Container from '../components/Container.astro';
import SearchModal from '../components/SearchModal';
import '../styles/global.css';

const { title = 'Led Kikaku Store' } = Astro.props;
const isAdmin = Astro.url.pathname.startsWith('/admin');
---

<!doctype html>
<html lang="ja">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<meta name="generator" content={Astro.generator} />
		<title>{title}</title>
	</head>
	<body class="font-sans text-[#1d1d1f] antialiased bg-[#f5f5f7]">
		<div class="min-h-screen flex flex-col">
			{/* Apple-style Global Nav: Sticky, Backdrop Blur, Minimal */}
			<header class="sticky top-0 z-50 w-full bg-white/70 backdrop-blur-xl border-b border-gray-200/50">
				<Container class="flex h-[48px] items-center justify-between">
					{/* Logo Area */}
					<a href={isAdmin ? '/admin/' : '/'} class="flex items-center gap-2 group transition-opacity hover:opacity-80">
						<span class="text-[17px] font-semibold tracking-tight">{isAdmin ? 'Led Kikaku OS' : 'LED Kikaku'}</span>
					</a>

					{/* Desktop Nav - Centered & Subtle */}
					<nav class="hidden md:flex items-center gap-8 text-[12px] font-normal text-[#1d1d1f]/80">
						{isAdmin ? (
							<>
								<a href="/admin/" class={`transition-colors hover:text-[#1d1d1f] ${Astro.url.pathname === '/admin/' || Astro.url.pathname === '/admin' ? 'text-[#1d1d1f] font-medium' : ''}`}>Dashboard</a>
								<a href="/admin/inbox" class={`transition-colors hover:text-[#1d1d1f] ${Astro.url.pathname.startsWith('/admin/inbox') ? 'text-[#1d1d1f] font-medium' : ''}`}>Inbox</a>
								<a href="/admin/orders" class={`transition-colors hover:text-[#1d1d1f] ${Astro.url.pathname.startsWith('/admin/orders') ? 'text-[#1d1d1f] font-medium' : ''}`}>Orders</a>
								<a href="/admin/customers" class={`transition-colors hover:text-[#1d1d1f] ${Astro.url.pathname.startsWith('/admin/customers') ? 'text-[#1d1d1f] font-medium' : ''}`}>Customers</a>
								<a href="/admin/shipping" class={`transition-colors hover:text-[#1d1d1f] ${Astro.url.pathname.startsWith('/admin/shipping') ? 'text-[#1d1d1f] font-medium' : ''}`}>Shipping</a>
								<a href="/admin/events" class={`transition-colors hover:text-[#1d1d1f] ${Astro.url.pathname.startsWith('/admin/events') ? 'text-[#1d1d1f] font-medium' : ''}`}>Events</a>
								<a href="/admin/products" class={`transition-colors hover:text-[#1d1d1f] ${Astro.url.pathname.startsWith('/admin/products') ? 'text-[#1d1d1f] font-medium' : ''}`}>Products</a>
								<a href="/admin/categories" class={`transition-colors hover:text-[#1d1d1f] ${Astro.url.pathname.startsWith('/admin/categories') ? 'text-[#1d1d1f] font-medium' : ''}`}>Categories</a>
								<a href="/admin/reports" class={`transition-colors hover:text-[#1d1d1f] ${Astro.url.pathname.startsWith('/admin/reports') ? 'text-[#1d1d1f] font-medium' : ''}`}>Reports</a>
								<a href="/admin/ledger" class={`transition-colors hover:text-[#1d1d1f] ${Astro.url.pathname.startsWith('/admin/ledger') ? 'text-[#1d1d1f] font-medium' : ''}`}>Ledger</a>
							</>
						) : (
							<>
								<a href="/" class={`transition-colors hover:text-[#1d1d1f] ${Astro.url.pathname === '/' ? 'text-[#1d1d1f] font-medium' : ''}`}>Store</a>
								<a href="/products" class={`transition-colors hover:text-[#1d1d1f] ${Astro.url.pathname.startsWith('/products') ? 'text-[#1d1d1f] font-medium' : ''}`}>Products</a>
								<a href="/terms" class={`transition-colors hover:text-[#1d1d1f] ${Astro.url.pathname === '/terms' ? 'text-[#1d1d1f] font-medium' : ''}`}>Support</a>
							</>
						)}
					</nav>
					
					{/* Utilities: Search & Cart */}
					<div class="flex items-center gap-6">
						{!isAdmin && (
							<button id="search-btn" type="button" class="text-[#1d1d1f]/80 hover:text-[#1d1d1f] transition-colors">
								<span class="sr-only">Search</span>
								<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
							</button>
						)}
						{!isAdmin && (
							<a href="/cart" id="cart-link" class="relative text-[#1d1d1f]/80 hover:text-[#1d1d1f] transition-colors">
								<span class="sr-only">Open cart</span>
								<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z"/><path d="M3 6h18"/><path d="M16 10a4 4 0 0 1-8 0"/></svg>
								<span id="cart-badge" class="hidden absolute -top-2 -right-2 h-4 w-4 rounded-full bg-[#0071e3] text-[10px] font-medium text-white flex items-center justify-center">0</span>
							</a>
						)}
					</div>
				</Container>
			</header>

			<main class="flex-1">
				<slot />
			</main>

			<footer class="bg-[#f5f5f7] border-t border-gray-200 py-10 text-[11px] text-[#86868b]">
				<Container>
					<div class="grid grid-cols-2 gap-8 md:grid-cols-4 lg:grid-cols-5 mb-8">
						<div class="space-y-3">
							<h3 class="font-semibold text-[#1d1d1f]">Shop and Learn</h3>
							<ul class="space-y-2">
								<li><a href="/products" class="hover:underline">Store</a></li>
								<li><a href="#" class="hover:underline">Mac</a></li>
								<li><a href="#" class="hover:underline">iPad</a></li>
							</ul>
						</div>
						<div class="space-y-3">
							<h3 class="font-semibold text-[#1d1d1f]">Account</h3>
							<ul class="space-y-2">
								<li><a href="#" class="hover:underline">Manage Your ID</a></li>
								<li><a href="#" class="hover:underline">Store Account</a></li>
								<li><a href="#" class="hover:underline">iCloud.com</a></li>
							</ul>
						</div>
						<div class="space-y-3">
							<h3 class="font-semibold text-[#1d1d1f]">Values</h3>
							<ul class="space-y-2">
								<li><a href="#" class="hover:underline">Accessibility</a></li>
								<li><a href="#" class="hover:underline">Education</a></li>
								<li><a href="#" class="hover:underline">Environment</a></li>
							</ul>
						</div>
						<div class="space-y-3">
							<h3 class="font-semibold text-[#1d1d1f]">About</h3>
							<ul class="space-y-2">
								<li><a href="#" class="hover:underline">Newsroom</a></li>
								<li><a href="#" class="hover:underline">Leadership</a></li>
								<li><a href="#" class="hover:underline">Investors</a></li>
							</ul>
						</div>
					</div>
					
					<div class="pt-4 border-t border-gray-200 flex flex-col md:flex-row justify-between items-center gap-4">
						<p>Copyright Â© 2024 Led Kikaku Inc. All rights reserved.</p>
						<div class="flex gap-4">
							<a href="/privacy" class="hover:underline border-r border-gray-300 pr-4 last:border-0 last:pr-0">Privacy Policy</a>
							<a href="/terms" class="hover:underline border-r border-gray-300 pr-4 last:border-0 last:pr-0">Terms of Use</a>
							<a href="/refund" class="hover:underline">Sales and Refunds</a>
						</div>
					</div>
				</Container>
			</footer>
		</div>

		{/* Search Modal */}
		{!isAdmin && <SearchModal client:only="react" />}

		<script>
			import { $cartCount } from '../lib/cart';

			const updateCartBadge = () => {
				const badge = document.getElementById('cart-badge');
				if (!badge) return;

				const count = $cartCount.get();
				if (count > 0) {
					badge.textContent = String(count > 99 ? '99+' : count);
					badge.classList.remove('hidden');
				} else {
					badge.classList.add('hidden');
				}
			};

			// Initial update
			updateCartBadge();

			// Subscribe to cart changes
			$cartCount.subscribe(updateCartBadge);

			// Search functionality
			const searchBtn = document.getElementById('search-btn');
			searchBtn?.addEventListener('click', () => {
				window.dispatchEvent(new CustomEvent('open-search'));
			});

			// Cmd+K / Ctrl+K shortcut
			document.addEventListener('keydown', (e) => {
				if ((e.metaKey || e.ctrlKey) && e.key === 'k') {
					e.preventDefault();
					window.dispatchEvent(new CustomEvent('open-search'));
				}
			});
		</script>
	</body>
</html>
